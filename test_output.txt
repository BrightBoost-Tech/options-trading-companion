============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
plugins: anyio-4.12.0
collected 3 items

packages/quantum/tests/test_rebalance_score.py FFF                       [100%]

=================================== FAILURES ===================================
_______________________ test_rebalance_engine_no_fake_ev _______________________

    def test_rebalance_engine_no_fake_ev():
        """
        Ensures that RebalanceEngine does not calculate a fake EV
        and instead uses RebalanceScore logic.
        """
        engine = RebalanceEngine(supabase=None)

        # Mock Inputs
>       spread = SpreadPosition(
            ticker="SPY",
            underlying="SPY",
            spread_type="call_debit",
            legs=[],
            quantity=1.0,
            current_value=1000.0,
            net_delta=0.5,
            net_gamma=0.01,
            net_vega=10.0,
            net_theta=-5.0
        )
E       pydantic_core._pydantic_core.ValidationError: 8 validation errors for SpreadPosition
E       id
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       user_id
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       spread_type
E         Input should be 'debit_call', 'debit_put', 'credit_call', 'credit_put', 'vertical', 'iron_condor', 'other', 'single', 'custom', 'credit_spread' or 'debit_spread' [type=literal_error, input_value='call_debit', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/literal_error
E       net_cost
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       delta
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       gamma
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       vega
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       theta
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...10.0, 'net_theta': -5.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing

packages/quantum/tests/test_rebalance_score.py:15: ValidationError
____________________ test_rebalance_score_cost_sensitivity _____________________

    def test_rebalance_score_cost_sensitivity():
        """
        Verifies that higher execution cost lowers the score.
        """
        engine = RebalanceEngine(supabase=None)

        # Mock Execution Service inside engine to control cost
        mock_exec_service = MagicMock()
        engine.execution_service = mock_exec_service

        # Scenario 1: Low Cost
        mock_exec_service.estimate_execution_cost.return_value = 0.05 # 5 cents

>       spread = SpreadPosition(ticker="ABC", underlying="ABC", spread_type="stock", legs=[], quantity=1.0, current_value=100.0, net_delta=1.0)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 8 validation errors for SpreadPosition
E       id
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       user_id
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       spread_type
E         Input should be 'debit_call', 'debit_put', 'credit_call', 'credit_put', 'vertical', 'iron_condor', 'other', 'single', 'custom', 'credit_spread' or 'debit_spread' [type=literal_error, input_value='stock', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/literal_error
E       net_cost
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       delta
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       gamma
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       vega
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       theta
E         Field required [type=missing, input_value={'ticker': 'ABC', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing

packages/quantum/tests/test_rebalance_score.py:89: ValidationError
_____________________ test_rebalance_score_regime_penalty ______________________

    def test_rebalance_score_regime_penalty():
        """
        Verifies that PANIC regime adds penalty.
        """
        engine = RebalanceEngine(supabase=None)

>       spread = SpreadPosition(ticker="SPY", underlying="SPY", spread_type="stock", legs=[], quantity=1.0, current_value=100.0, net_delta=1.0)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 8 validation errors for SpreadPosition
E       id
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       user_id
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       spread_type
E         Input should be 'debit_call', 'debit_put', 'credit_call', 'credit_put', 'vertical', 'iron_condor', 'other', 'single', 'custom', 'credit_spread' or 'debit_spread' [type=literal_error, input_value='stock', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/literal_error
E       net_cost
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       delta
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       gamma
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       vega
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing
E       theta
E         Field required [type=missing, input_value={'ticker': 'SPY', 'underl...100.0, 'net_delta': 1.0}, input_type=dict]
E           For further information visit https://errors.pydantic.dev/2.12/v/missing

packages/quantum/tests/test_rebalance_score.py:134: ValidationError
=============================== warnings summary ===============================
../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:20
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:20: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class BaseBucket(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:130
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:130: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SignedUrlJsonResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:134
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:134: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class SignedUrlsJsonItem(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:143
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:143: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class CreateSignedUploadUrlOptions(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:161
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:161: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class MetadataConfiguration(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:167
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:167: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListIndexesOptions(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:173
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:173: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListIndexesResponseItem(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:177
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:177: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListVectorIndexesResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:182
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:182: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorIndex(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:194
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:194: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class GetVectorIndexResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:201
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:201: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorData(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:205
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:205: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorObject(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:211
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:211: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorMatch(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:218
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:218: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class GetVectorsResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:222
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:222: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListVectorsResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:227
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:227: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class QueryVectorsResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:231
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:231: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AnalyticsBucket(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:245
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:245: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class AnalyticsBucketDeleteResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:249
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:249: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorBucketEncryptionConfiguration(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:254
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:254: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VectorBucket(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:260
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:260: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class GetVectorBucketResponse(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:264
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:264: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListVectorBucketsItem(BaseModel, extra=Extra.ignore):

../home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:268
  /home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/storage3/types.py:268: PydanticDeprecatedSince20: `pydantic.config.Extra` is deprecated, use literal values instead (e.g. `extra='allow'`). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ListVectorBucketsResponse(BaseModel, extra=Extra.ignore):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED packages/quantum/tests/test_rebalance_score.py::test_rebalance_engine_no_fake_ev
FAILED packages/quantum/tests/test_rebalance_score.py::test_rebalance_score_cost_sensitivity
FAILED packages/quantum/tests/test_rebalance_score.py::test_rebalance_score_regime_penalty
======================== 3 failed, 23 warnings in 0.82s ========================
